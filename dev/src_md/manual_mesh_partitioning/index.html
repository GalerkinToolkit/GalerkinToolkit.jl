<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Mesh partitioning · GalerkinToolkit.jl</title><meta name="title" content="Mesh partitioning · GalerkinToolkit.jl"/><meta property="og:title" content="Mesh partitioning · GalerkinToolkit.jl"/><meta property="twitter:title" content="Mesh partitioning · GalerkinToolkit.jl"/><meta name="description" content="Documentation for GalerkinToolkit.jl."/><meta property="og:description" content="Documentation for GalerkinToolkit.jl."/><meta property="twitter:description" content="Documentation for GalerkinToolkit.jl."/><meta property="og:url" content="https://GalerkinToolkit.github.io/GalerkinToolkit.jl/src_md/manual_mesh_partitioning/"/><meta property="twitter:url" content="https://GalerkinToolkit.github.io/GalerkinToolkit.jl/src_md/manual_mesh_partitioning/"/><link rel="canonical" href="https://GalerkinToolkit.github.io/GalerkinToolkit.jl/src_md/manual_mesh_partitioning/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/citations.css" rel="stylesheet" type="text/css"/><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="GalerkinToolkit.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">GalerkinToolkit.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../manual/">Manual</a></li><li><a class="tocitem" href="../../manual/introduction/">Introduction</a></li><li><a class="tocitem" href="../manual_meshes/">Meshes</a></li><li class="is-active"><a class="tocitem" href>Mesh partitioning</a><ul class="internal"><li><a class="tocitem" href="#Data-partition-model"><span>Data partition model</span></a></li></ul></li><li><a class="tocitem" href="../manual_domains/">Domains</a></li><li><a class="tocitem" href="../manual_interpolation/">Interpolation</a></li><li><a class="tocitem" href="../manual_visualization/">Visualization</a></li><li><a class="tocitem" href="../../manual/for_developers/">For developers</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/">Examples</a></li><li><a class="tocitem" href="../example_hello_world/">Hello, World!</a></li><li><a class="tocitem" href="../example_poisson_equation/">Poisson equation</a></li><li><a class="tocitem" href="../example_p_laplacian/">p-Laplacian</a></li><li><a class="tocitem" href="../example_stokes/">Stokes lid-driven cavity</a></li><li><a class="tocitem" href="../example_transient_heat_eq/">Transient heat equation</a></li><li><a class="tocitem" href="../example_hello_world_dg/">Discontinuous Galerkin</a></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/">Tutorials</a></li><li><a class="tocitem" href="../tutorial_intro_to_fem/">Introduction to the FEM</a></li></ul></li><li><a class="tocitem" href="../../reference/">API</a></li><li><a class="tocitem" href="../../refindex/">Index</a></li><li><a class="tocitem" href="../../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Mesh partitioning</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Mesh partitioning</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/GalerkinToolkit/GalerkinToolkit.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/GalerkinToolkit/GalerkinToolkit.jl/blob/main/docs/src/src_jl/manual_mesh_partitioning.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Mesh-partitioning"><a class="docs-heading-anchor" href="#Mesh-partitioning">Mesh partitioning</a><a id="Mesh-partitioning-1"></a><a class="docs-heading-anchor-permalink" href="#Mesh-partitioning" title="Permalink"></a></h1><p>One can partition mesh objects and distribute them over different process for computations on large-scale parallel systems. <a href="https://github.com/PartitionedArrays/PartitionedArrays.jl">PartitionedArrays.jl</a> is used under-the-hood to distribute the vectors defining the mesh object. This allows one to use several backends including MPI (by default), and the debug-backend of PartitionedArrays for developing and debugging purposes.</p><h2 id="Data-partition-model"><a class="docs-heading-anchor" href="#Data-partition-model">Data partition model</a><a id="Data-partition-model-1"></a><a class="docs-heading-anchor-permalink" href="#Data-partition-model" title="Permalink"></a></h2><p>A partitioned mesh is made of the same vectors as a sequential mesh, except for the fact that these vectors are of type <code>PVector</code>, the type representing a distributed vector in PartitionedArrays. Thus, one can work with a partitioned mesh as with a sequential mesh, as long as you don&#39;t index the <code>PVector</code> objects directly (which is intentionally forbidden by PartitionedArrays for performance reasons). The usage of partitioned meshes is transparent to the user in most of the cases, as one rarely works with the underlying data directly. Functions that you call on a partitioned mesh and access the underlying mesh data, are dispatched to parallel implementations that carefully access the partitioned data. In particular, types that build on top of a partitioned mesh also distribute data using <code>PVector</code> objects. The same usage remarks apply to them.</p><p>The mesh data in a <code>mesh</code> object is partitioned as follows:</p><ul><li><code>GT.node_coordinates(mesh)</code> is a <code>PVector</code> distributed over nodes containing node coordinates.</li><li><code>GT.face_nodes(mesh,d)</code> is a <code>PVector</code> distributed over <code>d</code>-faces of containing <em>global</em> node ids.</li><li><code>GT.reference_spaces(mesh,d)</code> is typically a small tuple which is replicated across all processes.</li><li><code>GT.face_reference_id(mesh,d)</code> is a <code>PVector</code> distributed over <code>d</code>-faces  containing <em>global</em> reference indices.</li><li><code>GT.group_faces(mesh,d)</code> is a <code>Dict{String,PVector}</code> object whose keys are replicated on all processes. <code>GT.group_faces(mesh,d)[key]</code> is a <code>PVector</code> distributed over the faces in this group containing <em>global</em> face ids.</li><li>Other vectors like <code>normals(mesh)</code> are distributed following the same principle.</li></ul><p>All these <code>PVector</code> objects only include own indices and point to global indices.  This allows us to distribute node and face data in an arbitrary way.</p><h3 id="Creating-partitioned-meshes"><a class="docs-heading-anchor" href="#Creating-partitioned-meshes">Creating partitioned meshes</a><a id="Creating-partitioned-meshes-1"></a><a class="docs-heading-anchor-permalink" href="#Creating-partitioned-meshes" title="Permalink"></a></h3><p>A partitioned mesh can be created with function <a href="../../reference/#GalerkinToolkit.with_mesh_partitioner"><code>with_mesh_partitioner</code></a>.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="GalerkinToolkit.with_mesh_partitioner-src_md-manual_mesh_partitioning" href="#GalerkinToolkit.with_mesh_partitioner-src_md-manual_mesh_partitioning"><code>GalerkinToolkit.with_mesh_partitioner</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">with_mesh_partitioner(mesher[,partitioner];[parts])</code></pre><p>Generate a mesh calling <code>mesher()</code> partition it, and distribute it over the part ids in <code>parts</code>.</p><p><strong>Arguments</strong></p><ul><li>Function <code>mesher()</code> should have no arguments and returns a sequential mesh object. This function is called only on one process.</li><li><code>partitioner</code> [optional]: A function that takes a graph encoded as a sparse matrix, and returns a vector containing the part id of each node in the graph. Defaults to <code>Metis.partition</code>.</li></ul><p><strong>Keyword arguments</strong></p><ul><li><code>parts</code> [optional]: A vector containing the part indices <code>1:P</code> where <code>P</code> is the number of parts in the data distribution. By default, <code>P</code> is the number of MPI ranks and <code>1:P</code> is distributed one item per rank.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/GalerkinToolkit/GalerkinToolkit.jl/blob/2fe2714250456d0398d562a02ec20d2200738f47/src/mesh.jl#L911-L925">source</a></section></article><h3 id="Example"><a class="docs-heading-anchor" href="#Example">Example</a><a id="Example-1"></a><a class="docs-heading-anchor-permalink" href="#Example" title="Permalink"></a></h3><p>Create a 3D mesh from a <code>msh</code> file partitioned into 5 parts. Visualize the mesh using colors according to part owner.</p><pre><code class="language-julia hljs">import GalerkinToolkit as GT
import GLMakie
import Makie

parts = 1:5
mesh = GT.with_mesh_partitioner(;parts) do
    assets_dir = normpath(joinpath(@__DIR__,&quot;..&quot;,&quot;..&quot;,&quot;..&quot;,&quot;assets&quot;))
    msh_file = joinpath(assets_dir,&quot;model.msh&quot;)
    GT.mesh_from_msh(msh_file)
end

#Visualize it
fig = Makie.Figure()
elevation = 0.24π
azimuth = -0.55π
aspect = :data
ax = Makie.Axis3(fig[1,1];aspect,elevation,azimuth)
Makie.hidespines!(ax)
Makie.hidedecorations!(ax)
color = GT.FaceColor(&quot;__OWNER__&quot;)
GT.makie_surfaces!(mesh;color)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Main.mesh_partitioning_1</code></pre><p><img src="../fig_meshes_12.png" alt/></p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../manual_meshes/">« Meshes</a><a class="docs-footer-nextpage" href="../manual_domains/">Domains »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Friday 3 October 2025 18:05">Friday 3 October 2025</span>. Using Julia version 1.11.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
