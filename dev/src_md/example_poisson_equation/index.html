<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Poisson equation · GalerkinToolkit.jl</title><meta name="title" content="Poisson equation · GalerkinToolkit.jl"/><meta property="og:title" content="Poisson equation · GalerkinToolkit.jl"/><meta property="twitter:title" content="Poisson equation · GalerkinToolkit.jl"/><meta name="description" content="Documentation for GalerkinToolkit.jl."/><meta property="og:description" content="Documentation for GalerkinToolkit.jl."/><meta property="twitter:description" content="Documentation for GalerkinToolkit.jl."/><meta property="og:url" content="https://GalerkinToolkit.github.io/GalerkinToolkit.jl/src_md/example_poisson_equation/"/><meta property="twitter:url" content="https://GalerkinToolkit.github.io/GalerkinToolkit.jl/src_md/example_poisson_equation/"/><link rel="canonical" href="https://GalerkinToolkit.github.io/GalerkinToolkit.jl/src_md/example_poisson_equation/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/citations.css" rel="stylesheet" type="text/css"/><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="GalerkinToolkit.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">GalerkinToolkit.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../manual/">Manual</a></li><li><a class="tocitem" href="../../manual/introduction/">Introduction</a></li><li><a class="tocitem" href="../manual_geometry/">Geometric foundations</a></li><li><a class="tocitem" href="../../manual/for_developers/">For developers</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/">Examples</a></li><li><a class="tocitem" href="../example_hello_world/">Hello, World!</a></li><li class="is-active"><a class="tocitem" href>Poisson equation</a><ul class="internal"><li><a class="tocitem" href="#Problem-statement"><span>Problem statement</span></a></li><li><a class="tocitem" href="#Numerical-scheme"><span>Numerical scheme</span></a></li><li><a class="tocitem" href="#Implementation"><span>Implementation</span></a></li><li><a class="tocitem" href="#Explicit-integration-loops"><span>Explicit integration loops</span></a></li></ul></li><li><a class="tocitem" href="../example_p_laplacian/">p-Laplacian</a></li><li><a class="tocitem" href="../example_stokes/">Stokes lid-driven cavity</a></li><li><a class="tocitem" href="../example_transient_heat_eq/">Transient heat equation</a></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/">Tutorials</a></li><li><a class="tocitem" href="../tutorial_intro_to_fem/">Introduction to the FEM</a></li></ul></li><li><a class="tocitem" href="../../reference/">API</a></li><li><a class="tocitem" href="../../refindex/">Index</a></li><li><a class="tocitem" href="../../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Poisson equation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Poisson equation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/GalerkinToolkit/GalerkinToolkit.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/GalerkinToolkit/GalerkinToolkit.jl/blob/main/docs/src/src_jl/example_poisson_equation.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Poisson-equation"><a class="docs-heading-anchor" href="#Poisson-equation">Poisson equation</a><a id="Poisson-equation-1"></a><a class="docs-heading-anchor-permalink" href="#Poisson-equation" title="Permalink"></a></h1><p><img src="../fig_poisson_1.png" alt/></p><h2 id="Problem-statement"><a class="docs-heading-anchor" href="#Problem-statement">Problem statement</a><a id="Problem-statement-1"></a><a class="docs-heading-anchor-permalink" href="#Problem-statement" title="Permalink"></a></h2><p>We want to solve a simple Poisson equation, but this time on a more complex domain and also including Neumann boundary conditions.  Dirichlet boundary conditions are applied on <span>$\Gamma_{\rm D}$</span>, non-homogeneous Neumann conditions are applied on <span>$\Gamma_{\rm N}$</span>,   and homogeneous Neumann boundary conditions are applied on the remaining portion of the boundary. The computational domains are defined in the mesh file <code>model.msh</code>. The domain <span>$\Omega$</span> is represented by the 3D faces in this mesh. The domain <span>$\Gamma_{\rm D}$</span> is represented by the physical group named <code>&quot;sides&quot;</code> and <span>$\Gamma_{\rm N}$</span> is the union of the physical groups named <code>&quot;circle&quot;</code>, <code>&quot;triangle&quot;</code>, and <code>&quot;square&quot;</code>.</p><p>Formally, the problem to solve is: find the scalar field <span>$u$</span> such that</p><p class="math-container">\[\left\lbrace
\begin{aligned}
-\Delta u = f  \ &amp;\text{in} \ \Omega,\\
u = g \ &amp;\text{on}\ \Gamma_{\rm D},\\
\nabla u\cdot n = h \ &amp;\text{on}\  \Gamma_{\rm N},\\
\nabla u\cdot n = 0 \ &amp;\text{elsewhere on}\  \partial \Omega,\\
\end{aligned}
\right.\]</p><p>being <span>$n$</span> the outwards unit normal vector to <span>$\partial\Omega$</span>. In this example, we chose <span>$f(x) = 1$</span>, <span>$g(x) = 2$</span>, and <span>$h(x)=3$</span>. The variable <span>$x$</span> is the position vector <span>$x=(x_1,x_2,x_3)$</span>.</p><h2 id="Numerical-scheme"><a class="docs-heading-anchor" href="#Numerical-scheme">Numerical scheme</a><a id="Numerical-scheme-1"></a><a class="docs-heading-anchor-permalink" href="#Numerical-scheme" title="Permalink"></a></h2><p>We use a conventional Galerkin finite element (FE) method with conforming Lagrangian FE spaces (see, e.g., [<a href="../../references/#Johnson2009">1</a>]).  The weak form equation we solve consists in finding <span>$u_h\in V_g$</span> such that <span>$a(u_h,v) = \ell(v)$</span> for all <span>$v\in V_0$</span>. To this end we build a space <span>$V$</span> spanned by continuous and piece-wise Lagrangian basis functions. The auxiliary spaces <span>$V_g$</span> and <span>$V_0$</span> are the subsets of <span>$V$</span> that fulfill the Dirichlet boundary condition <span>$g$</span> and <span>$0$</span> on <span>$\partial\Omega$</span> respectively. The bilinear and linear forms are</p><p class="math-container">\[  a(u,v) \doteq \int_{\Omega} \nabla v \cdot \nabla u \ {\rm d}\Omega, \quad b(v) \doteq \int_{\Omega} v\ f  \ {\rm  d}\Omega + \int_{\Gamma_{\rm N}} v\ h \ {\rm d}\Gamma_{\rm N}.\]</p><p>This equation results in a system of linear algebraic equations that is solved using an external linear solver from <a href="https://github.com/SciML/LinearSolve.jl"><code>LinearSolve.jl</code></a>.</p><h2 id="Implementation"><a class="docs-heading-anchor" href="#Implementation">Implementation</a><a id="Implementation-1"></a><a class="docs-heading-anchor-permalink" href="#Implementation" title="Permalink"></a></h2><pre><code class="language-julia hljs">using LinearAlgebra
import GalerkinToolkit as GT
import LinearSolve
import ForwardDiff
import GLMakie as Makie

#Read the mesh file
assets_dir = normpath(joinpath(@__DIR__,&quot;..&quot;,&quot;..&quot;,&quot;..&quot;,&quot;assets&quot;))
msh_file = joinpath(assets_dir,&quot;model.msh&quot;)
mesh = GT.mesh_from_msh(msh_file)

#Geometry
dirichlet_names = [&quot;sides&quot;]
neumann_names = [&quot;circle&quot;, &quot;triangle&quot;, &quot;square&quot;]
Ω = GT.interior(mesh)
Γd = GT.boundary(mesh;physical_names=dirichlet_names)
Γn = GT.boundary(mesh;physical_names=neumann_names)

#Define forcing data
f = GT.analytical_field(x-&gt;1.0,Ω)
g = GT.analytical_field(x-&gt;2.0,Ω)
h = GT.analytical_field(x-&gt;3.0,Ω)

#Define the interpolation space.
k = 1
V = GT.lagrange_space(Ω,k;dirichlet_boundary=Γd)

#Interpolate Dirichlet values.
T = Float64
uhd = GT.zero_dirichlet_field(T,V)
GT.interpolate_dirichlet!(g,uhd)

#Define numerical integration.
degree = 2*k
dΩ = GT.measure(Ω,degree)
dΓn = GT.measure(Γn,degree)

#Define weak form.
∇ = ForwardDiff.gradient
a = (u,v) -&gt; GT.∫( x-&gt;∇(u,x)⋅∇(v,x), dΩ)
l = v -&gt; GT.∫( x-&gt;v(x)*f(x), dΩ) + GT.∫( x-&gt;v(x)*h(x), dΓn)

#Assemble the problem and solve it
p = GT.SciMLBase_LinearProblem(uhd,a,l)
sol = LinearSolve.solve(p)

#Build the FE solution.
uh = GT.solution_field(uhd,sol)

#Visualize the solution.
fig = Makie.Figure()
elevation = 0.24π
azimuth = -0.55π
aspect = :data
ax = Makie.Axis3(fig[1,1];aspect,elevation,azimuth)
Makie.hidespines!(ax)
Makie.hidedecorations!(ax)
GT.makie_surface!(Ω;color=uh)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Info    : Reading &#39;/home/runner/work/GalerkinToolkit.jl/GalerkinToolkit.jl/assets/model.msh&#39;...
Info    : 95 entities
Info    : 2151 nodes
Info    : 10691 elements
Info    : Done reading &#39;/home/runner/work/GalerkinToolkit.jl/GalerkinToolkit.jl/assets/model.msh&#39;</code></pre><h2 id="Explicit-integration-loops"><a class="docs-heading-anchor" href="#Explicit-integration-loops">Explicit integration loops</a><a id="Explicit-integration-loops-1"></a><a class="docs-heading-anchor-permalink" href="#Explicit-integration-loops" title="Permalink"></a></h2><p>This other code version implements the integration loops manually instead of relying on the underlying automatic code generation. It shows how to handle the source term and the Neumann boundary condition.</p><pre><code class="language-julia hljs">#Manually written assembly function
#Always use a function, never the global scope
function assemble_in_Ω!(A_alloc,Ad_alloc,b_alloc,V,f,dΩ)

    #Accessors to the quantities on the
    #integration points
    Ω = GT.domain(dΩ)
    face_point_x = GT.coordinate_accessor(dΩ)
    face_point_J = GT.jacobian_accessor(dΩ)
    face_point_dV = GT.weight_accessor(dΩ)
    face_npoints = GT.num_points_accessor(dΩ)
    face_dofs = GT.dofs_accessor(V,Ω)
    face_point_dof_s = GT.shape_function_accessor(GT.value,V,dΩ)
    ∇ = ForwardDiff.gradient
    face_point_dof_∇s = GT.shape_function_accessor(∇,V,dΩ)

    #Temporaries
    n = GT.max_num_reference_dofs(V)
    T = Float64
    Auu = zeros(T,n,n)
    bu = zeros(T,n)

    #Numerical integration loop
    for face in 1:GT.num_faces(Ω)

        #Get quantities at current face
        npoints = face_npoints(face)
        point_x = face_point_x(face)
        point_J = face_point_J(face)
        point_dV = face_point_dV(face)
        point_dof_s = face_point_dof_s(face)
        point_dof_∇s = face_point_dof_∇s(face)
        dofs = face_dofs(face)

        #Reset face matrix
        fill!(Auu,zero(T))
        fill!(bu,zero(T))

        #Loop over integration points
        for point in 1:npoints

            #Get quantities at current integration point
            x = point_x(point)
            J = point_J(point)
            dV = point_dV(point,J)
            dof_s = point_dof_s(point)
            dof_∇s = point_dof_∇s(point,J)

            #Fill in face matrix and vector
            for (i,dofi) in enumerate(dofs)
                v = dof_s(i)
                ∇v = dof_∇s(i)
                bu[i] += f.definition(x)*v*dV
                for (j,dofj) in enumerate(dofs)
                    ∇u = dof_∇s(j)
                    Auu[i,j] += ∇v⋅∇u*dV
                end
            end
        end

        #Add face contribution to the
        #global allocations
        GT.contribute!(A_alloc,Auu,dofs,dofs)
        GT.contribute!(Ad_alloc,Auu,dofs,dofs)
        GT.contribute!(b_alloc,bu,dofs)
    end
end

#Manually written assembly function
#Always use a function, never the global scope
function assemble_in_Γn!(b_alloc,V,h,dΓn)

    #Accessors to the quantities on the
    #integration points
    Γn = GT.domain(dΓn)
    face_point_x = GT.coordinate_accessor(dΓn)
    face_point_dV = GT.weight_accessor(dΓn)
    face_npoints = GT.num_points_accessor(dΓn)
    face_dofs = GT.dofs_accessor(V,Γn)
    face_point_dof_s = GT.shape_function_accessor(GT.value,V,dΓn)

    #Temporaries
    n = GT.max_num_reference_dofs(V)
    T = Float64
    Auu = zeros(T,n,n)
    bu = zeros(T,n)

    #Numerical integration loop
    for face in 1:GT.num_faces(Γn)

        #Get quantities at current face
        npoints = face_npoints(face)
        point_x = face_point_x(face)
        point_dV = face_point_dV(face)
        point_dof_s = face_point_dof_s(face)
        dofs = face_dofs(face)

        #Reset face vector
        fill!(bu,zero(T))

        #Loop over integration points
        for point in 1:npoints

            #Get quantities at current integration point
            x = point_x(point)
            dV = point_dV(point)
            dof_s = point_dof_s(point)

            #Fill in face matrix and vector
            for (i,dofi) in enumerate(dofs)
                v = dof_s(i)
                bu[i] += h.definition(x)*v*dV
            end
        end

        #Add face contribution to the
        #global allocations
        GT.contribute!(b_alloc,bu,dofs)
    end
end

#Allocate matrix for free columns
A_alloc = GT.allocate_matrix(T,V,V,Ω)

#Allocate matrix for dirichlet columns
free_or_dirichlet=(GT.FREE,GT.DIRICHLET)
Ad_alloc = GT.allocate_matrix(T,V,V,Ω;free_or_dirichlet)

#Allocate rhs vector
b_alloc = GT.allocate_vector(T,V,Ω,Γn)

#Fill allocations with the function we wrote above
assemble_in_Ω!(A_alloc,Ad_alloc,b_alloc,V,f,dΩ)
assemble_in_Γn!(b_alloc,V,h,dΓn)

#Compress matrix and vector into the final format
A = GT.compress(A_alloc)
Ad = GT.compress(Ad_alloc)
b = GT.compress(b_alloc)

#Build the linear system
xd = GT.dirichlet_values(uhd)
b .= b .- Ad*xd
p = LinearSolve.LinearProblem(A,b)

#Solve the problem
sol = LinearSolve.solve(p)
uh = GT.solution_field(uhd,sol)

#Visualize the solution.
fig = Makie.Figure()
elevation = 0.24π
azimuth = -0.55π
aspect = :data
ax = Makie.Axis3(fig[1,1];aspect,elevation,azimuth)
Makie.hidespines!(ax)
Makie.hidedecorations!(ax)
GT.makie_surface!(Ω;color=uh)</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../example_hello_world/">« Hello, World!</a><a class="docs-footer-nextpage" href="../example_p_laplacian/">p-Laplacian »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.13.0 on <span class="colophon-date" title="Tuesday 8 July 2025 15:54">Tuesday 8 July 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
