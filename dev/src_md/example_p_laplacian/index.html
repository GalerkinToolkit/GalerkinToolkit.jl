<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>p-Laplacian · GalerkinToolkit</title><meta name="title" content="p-Laplacian · GalerkinToolkit"/><meta property="og:title" content="p-Laplacian · GalerkinToolkit"/><meta property="twitter:title" content="p-Laplacian · GalerkinToolkit"/><meta name="description" content="Documentation for GalerkinToolkit."/><meta property="og:description" content="Documentation for GalerkinToolkit."/><meta property="twitter:description" content="Documentation for GalerkinToolkit."/><meta property="og:url" content="https://GalerkinToolkit.github.io/GalerkinToolkit.jl/src_md/example_p_laplacian/"/><meta property="twitter:url" content="https://GalerkinToolkit.github.io/GalerkinToolkit.jl/src_md/example_p_laplacian/"/><link rel="canonical" href="https://GalerkinToolkit.github.io/GalerkinToolkit.jl/src_md/example_p_laplacian/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/citations.css" rel="stylesheet" type="text/css"/><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="GalerkinToolkit logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">GalerkinToolkit</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../manual/">Manual</a></li><li><a class="tocitem" href="../../manual/introduction/">Introduction</a></li><li><a class="tocitem" href="../manual_meshes/">Meshes</a></li><li><a class="tocitem" href="../manual_domains/">Domains</a></li><li><a class="tocitem" href="../manual_interpolation/">Interpolation</a></li><li><a class="tocitem" href="../manual_visualization/">Visualization</a></li><li><a class="tocitem" href="../../manual/for_developers/">For developers</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/">Examples</a></li><li><a class="tocitem" href="../example_hello_world/">Hello, World!</a></li><li><a class="tocitem" href="../example_poisson_equation/">Poisson equation</a></li><li class="is-active"><a class="tocitem" href>p-Laplacian</a><ul class="internal"><li><a class="tocitem" href="#Problem-statement"><span>Problem statement</span></a></li><li><a class="tocitem" href="#Numerical-scheme"><span>Numerical scheme</span></a></li><li><a class="tocitem" href="#Implementation"><span>Implementation</span></a></li><li><a class="tocitem" href="#Building-the-algebraic-non-linear-problem-explicitly"><span>Building the algebraic non-linear problem explicitly</span></a></li></ul></li><li><a class="tocitem" href="../example_stokes/">Stokes lid-driven cavity</a></li><li><a class="tocitem" href="../example_transient_heat_eq/">Transient heat equation</a></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/">Tutorials</a></li><li><a class="tocitem" href="../tutorial_intro_to_fem/">Introduction to the FEM</a></li></ul></li><li><a class="tocitem" href="../../reference/">API</a></li><li><a class="tocitem" href="../../refindex/">Index</a></li><li><a class="tocitem" href="../../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>p-Laplacian</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>p-Laplacian</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/GalerkinToolkit/GalerkinToolkit.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/GalerkinToolkit/GalerkinToolkit.jl/blob/main/docs/src/src_jl/example_p_laplacian.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="p-Laplacian"><a class="docs-heading-anchor" href="#p-Laplacian">p-Laplacian</a><a id="p-Laplacian-1"></a><a class="docs-heading-anchor-permalink" href="#p-Laplacian" title="Permalink"></a></h1><p><img src="../fig_p_laplacian_1.png" alt/></p><h2 id="Problem-statement"><a class="docs-heading-anchor" href="#Problem-statement">Problem statement</a><a id="Problem-statement-1"></a><a class="docs-heading-anchor-permalink" href="#Problem-statement" title="Permalink"></a></h2><p>Find the scalar-field <span>$u$</span> such that</p><p class="math-container">\[\left\lbrace
\begin{aligned}
-\nabla \cdot \sigma(u) = f\ &amp;\text{in}\ \Omega,\\
u = -1 \ &amp;\text{on} \ \Gamma_0,\\
u = 1 \ &amp;\text{on} \ \Gamma_1,\\
\sigma(u)\cdot n = 0 \ &amp;\text{elsewhere on} \ \partial\Omega,
\end{aligned}
\right.\]</p><p>with <span>$\sigma(u) = |\nabla u|^{p-2} \ \nabla u$</span> and <span>$p&gt;2$</span>. The vector field <span>$n$</span> is the outwards unit normal vector to <span>$\partial\Omega$</span>. The computational domains are defined in the mesh file <code>model.msh</code>. The domain <span>$\Omega$</span> is represented by the 3D faces in this mesh. The domain <span>$\Gamma_0$</span> is represented by the physical group named <code>&quot;sides&quot;</code> and <span>$\Gamma_1$</span> is the union of the physical groups named <code>&quot;circle&quot;</code>, <code>&quot;triangle&quot;</code>, and <code>&quot;square&quot;</code>.</p><h2 id="Numerical-scheme"><a class="docs-heading-anchor" href="#Numerical-scheme">Numerical scheme</a><a id="Numerical-scheme-1"></a><a class="docs-heading-anchor-permalink" href="#Numerical-scheme" title="Permalink"></a></h2><p>We discretize the problem with a space <span>$V$</span> with piece-wise continuous Lagrangian basis functions. For this formulation, the nonlinear weak form reads: find <span>$u\in V_g$</span> such that <span>$[r(u)](v) = 0$</span> for all <span>$v\in V_0$</span>. The auxiliary spaces <span>$V_g$</span> and <span>$V_0$</span> are the subsets of <span>$V$</span> that fulfill the Dirichlet boundary condition <span>$g$</span> and <span>$0$</span> on <span>$\partial\Omega$</span> respectively.</p><p>The weak residual <span>$r(u)$</span> evaluated at a function  <span>$u\in V_g$</span> is the linear form defined as</p><p class="math-container">\[[r(u)](v) \doteq \int_\Omega \nabla v \cdot \left( |\nabla u|^{p-2}\ \nabla u \right) \ {\rm d}\Omega - \int_\Omega v\ f \ {\rm d}\Omega.\]</p><p>In order to solve this nonlinear weak equation, we consider a Newton-Raphson method, which is associated with a linearization of the problem in an arbitrary direction <span>$\delta u\in V_0$</span>, namely <span>$[r(u+\delta u)](v)\approx [r(u)](v) + [j(u)](\delta u,v)$</span>. In previous formula,  <span>$j(u)$</span> is the Jacobian evaluated at <span>$u\in V_g$</span>, which is the bilinear form</p><p class="math-container">\[[j(u)](\delta u,v) = \int_\Omega \nabla v \cdot \left( |\nabla u|^{p-2}\ \nabla \delta u \right) \ {\rm d}\Omega + (p-2) \int_\Omega \nabla v \cdot \left(  |\nabla u|^{p-4} (\nabla u \cdot \nabla \delta u) \nabla u  \right) \ {\rm d}\Omega.\]</p><h2 id="Implementation"><a class="docs-heading-anchor" href="#Implementation">Implementation</a><a id="Implementation-1"></a><a class="docs-heading-anchor-permalink" href="#Implementation" title="Permalink"></a></h2><pre><code class="language-julia hljs">using LinearAlgebra
import GalerkinToolkit as GT
import PartitionedSolvers as PS
import NonlinearSolve
import ForwardDiff
import GLMakie as Makie

#Read and visualize the mesh
assets_dir = normpath(joinpath(@__DIR__,&quot;..&quot;,&quot;..&quot;,&quot;..&quot;,&quot;assets&quot;))
msh_file = joinpath(assets_dir,&quot;model.msh&quot;)
mesh = GT.mesh_from_msh(msh_file)

#Define domains
dirichlet_0_names = [&quot;sides&quot;]
dirichlet_1_names = [&quot;circle&quot;, &quot;triangle&quot;, &quot;square&quot;]
Ω = GT.interior(mesh)
Γ0 = GT.boundary(mesh;group_names=dirichlet_0_names)
Γ1 = GT.boundary(mesh;group_names=dirichlet_1_names)
Γd = GT.piecewise_domain(Γ0,Γ1)

#Define forcing data
g0 = GT.analytical_field(x-&gt;-1.0,Ω)
g1 = GT.analytical_field(x-&gt;1.0,Ω)
g = GT.piecewise_field(g0,g1)

#Define the interpolation space
k = 1
V = GT.lagrange_space(Ω,k;dirichlet_boundary=Γd)

#Interpolate Dirichlet values
T = Float64
uh = GT.rand_field(T,V)
GT.interpolate_dirichlet!(g,uh)

#Define numerical integration
degree = 2*k
dΩ = GT.measure(Ω,degree)

#Define weak form.
∇ = ForwardDiff.gradient
q = 3
flux(∇u) = norm(∇u)^(q-2) * ∇u
dflux(∇du,∇u) = (q-2)*norm(∇u)^(q-4)*(∇u⋅∇du)*∇u+norm(∇u)^(q-2)*∇du
r = u -&gt; v -&gt; GT.∫( x-&gt; ∇(v,x)⋅GT.call(flux,∇(u,x)), dΩ)
j = u -&gt; (du,v) -&gt; GT.∫( x-&gt; ∇(v,x)⋅GT.call(dflux,∇(du,x),∇(u,x)) , dΩ)

#Define non-linear problem
p = GT.SciMLBase_NonlinearProblem(uh,r,j)

#Solve it
sol = NonlinearSolve.solve(p;show_trace=Val(true))
@assert sol.retcode == NonlinearSolve.ReturnCode.Success

#Get the FE solution object
uh = GT.solution_field(uh,sol)

#Visualize the solution
fig = Makie.Figure()
elevation = 0.24π
azimuth = -0.55π
aspect = :data
ax = Makie.Axis3(fig[1,1];aspect,elevation,azimuth)
Makie.hidespines!(ax)
Makie.hidedecorations!(ax)
GT.makie_surfaces!(Ω;color=uh)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">
Algorithm: NewtonRaphson(
    descent = NewtonDescent(),
    autodiff = AutoForwardDiff(),
    vjp_autodiff = AutoFiniteDiff(
        fdtype = Val{:forward}(),
        fdjtype = Val{:forward}(),
        fdhtype = Val{:hcentral}(),
        dir = true
    ),
    jvp_autodiff = AutoForwardDiff(),
    concrete_jac = Val{false}()
)

----    	-------------       	-----------
Iter    	f(u) inf-norm       	Step 2-norm
----    	-------------       	-----------
0       	1.26741773e+01      	NaN
1       	3.16956871e+00      	1.68649496e+01
2       	7.94390709e-01      	7.85563564e+00
3       	2.03848687e-01      	3.09654159e+00
4       	4.59173779e-02      	9.93443285e-01
5       	9.39525425e-03      	2.58066948e-01
6       	9.88113637e-04      	6.33236015e-02
7       	5.79487533e-05      	1.34494411e-02
8       	2.46449999e-06      	1.85749018e-03
9       	5.69980683e-09      	7.42637557e-05
10      	3.10992280e-14      	1.36012244e-07
Final   	3.10992280e-14
----------------------</code></pre><h2 id="Building-the-algebraic-non-linear-problem-explicitly"><a class="docs-heading-anchor" href="#Building-the-algebraic-non-linear-problem-explicitly">Building the algebraic non-linear problem explicitly</a><a id="Building-the-algebraic-non-linear-problem-explicitly-1"></a><a class="docs-heading-anchor-permalink" href="#Building-the-algebraic-non-linear-problem-explicitly" title="Permalink"></a></h2><p>In this other version, we explicitly build the algebraic residual and Jacobian (functions that take plain Julia vectors) and build a algebraic non-linear problem from them.</p><pre><code class="language-julia hljs">import SciMLBase

#Initial guess
x = rand(T,GT.num_free_dofs(V))
GT.solution_field!(uh,x)

#Initial residual and Jacobian
reuse = Val(true)
parameters = (uh,)
b,residual_cache = GT.assemble_vector(r(uh),T,V;parameters,reuse)
A,jacobian_cache = GT.assemble_matrix(j(uh),T,V,V;parameters,reuse)

#Algebraic residual and Jacobian functions
function f(dx,x,p)
    GT.solution_field!(uh,x)
    GT.update_vector!(dx,residual_cache;parameters)
    dx
end

function jac(J,x,p)
    GT.solution_field!(uh,x)
    GT.update_matrix!(J,jacobian_cache;parameters)
    J
end

#Build the nonlinear problem
jac_prototype = A
nlfun = SciMLBase.NonlinearFunction(f;jac,jac_prototype)
p = SciMLBase.NonlinearProblem(nlfun,x)

#Solve it
sol = NonlinearSolve.solve(p;show_trace=Val(true))
@assert sol.retcode == NonlinearSolve.ReturnCode.Success

#Get the FE solution object
x = sol.u
GT.solution_field!(uh,x)

#Visualize the solution
fig = Makie.Figure()
elevation = 0.24π
azimuth = -0.55π
aspect = :data
ax = Makie.Axis3(fig[1,1];aspect,elevation,azimuth)
Makie.hidespines!(ax)
Makie.hidedecorations!(ax)
GT.makie_surfaces!(Ω;color=uh)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">
Algorithm: NewtonRaphson(
    descent = NewtonDescent(),
    autodiff = AutoForwardDiff(),
    vjp_autodiff = AutoFiniteDiff(
        fdtype = Val{:forward}(),
        fdjtype = Val{:forward}(),
        fdhtype = Val{:hcentral}(),
        dir = true
    ),
    jvp_autodiff = AutoForwardDiff(),
    concrete_jac = Val{false}()
)

----    	-------------       	-----------
Iter    	f(u) inf-norm       	Step 2-norm
----    	-------------       	-----------
0       	1.29104525e+01      	NaN
1       	3.35025824e+00      	1.67371952e+01
2       	8.67395735e-01      	7.74603729e+00
3       	2.02873598e-01      	3.06983236e+00
4       	3.50526828e-02      	9.93663070e-01
5       	8.72405101e-03      	2.56891191e-01
6       	1.09582966e-03      	5.80803613e-02
7       	2.43004996e-04      	1.26802241e-02
8       	4.24907762e-06      	2.72246528e-03
9       	1.78089476e-09      	7.46656900e-05
10      	1.37196976e-15      	4.95161196e-08
Final   	1.37196976e-15
----------------------</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../example_poisson_equation/">« Poisson equation</a><a class="docs-footer-nextpage" href="../example_stokes/">Stokes lid-driven cavity »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Monday 14 July 2025 15:17">Monday 14 July 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
