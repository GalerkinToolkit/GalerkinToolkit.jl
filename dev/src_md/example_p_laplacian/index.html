<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>p-Laplacian · GalerkinToolkit.jl</title><meta name="title" content="p-Laplacian · GalerkinToolkit.jl"/><meta property="og:title" content="p-Laplacian · GalerkinToolkit.jl"/><meta property="twitter:title" content="p-Laplacian · GalerkinToolkit.jl"/><meta name="description" content="Documentation for GalerkinToolkit.jl."/><meta property="og:description" content="Documentation for GalerkinToolkit.jl."/><meta property="twitter:description" content="Documentation for GalerkinToolkit.jl."/><meta property="og:url" content="https://GalerkinToolkit.github.io/GalerkinToolkit.jl/src_md/example_p_laplacian/"/><meta property="twitter:url" content="https://GalerkinToolkit.github.io/GalerkinToolkit.jl/src_md/example_p_laplacian/"/><link rel="canonical" href="https://GalerkinToolkit.github.io/GalerkinToolkit.jl/src_md/example_p_laplacian/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/citations.css" rel="stylesheet" type="text/css"/><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="GalerkinToolkit.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">GalerkinToolkit.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../manual/">Manual</a></li><li><a class="tocitem" href="../../manual/introduction/">Introduction</a></li><li><a class="tocitem" href="../manual_meshes/">Meshes</a></li><li><a class="tocitem" href="../manual_domains/">Domains</a></li><li><a class="tocitem" href="../manual_interpolation/">Interpolation</a></li><li><a class="tocitem" href="../manual_visualization/">Visualization</a></li><li><a class="tocitem" href="../../manual/for_developers/">For developers</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/">Examples</a></li><li><a class="tocitem" href="../example_hello_world/">Hello, World!</a></li><li><a class="tocitem" href="../example_poisson_equation/">Poisson equation</a></li><li class="is-active"><a class="tocitem" href>p-Laplacian</a><ul class="internal"><li><a class="tocitem" href="#Problem-statement"><span>Problem statement</span></a></li><li><a class="tocitem" href="#Numerical-scheme"><span>Numerical scheme</span></a></li><li><a class="tocitem" href="#Implementation"><span>Implementation</span></a></li><li><a class="tocitem" href="#Building-the-algebraic-non-linear-problem-explicitly"><span>Building the algebraic non-linear problem explicitly</span></a></li></ul></li><li><a class="tocitem" href="../example_stokes/">Stokes lid-driven cavity</a></li><li><a class="tocitem" href="../example_transient_heat_eq/">Transient heat equation</a></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/">Tutorials</a></li><li><a class="tocitem" href="../tutorial_intro_to_fem/">Introduction to the FEM</a></li></ul></li><li><a class="tocitem" href="../../reference/">API</a></li><li><a class="tocitem" href="../../refindex/">Index</a></li><li><a class="tocitem" href="../../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>p-Laplacian</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>p-Laplacian</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/GalerkinToolkit/GalerkinToolkit.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/GalerkinToolkit/GalerkinToolkit.jl/blob/main/docs/src/src_jl/example_p_laplacian.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="p-Laplacian"><a class="docs-heading-anchor" href="#p-Laplacian">p-Laplacian</a><a id="p-Laplacian-1"></a><a class="docs-heading-anchor-permalink" href="#p-Laplacian" title="Permalink"></a></h1><p><img src="../fig_p_laplacian_1.png" alt/></p><h2 id="Problem-statement"><a class="docs-heading-anchor" href="#Problem-statement">Problem statement</a><a id="Problem-statement-1"></a><a class="docs-heading-anchor-permalink" href="#Problem-statement" title="Permalink"></a></h2><p>Find the scalar-field <span>$u$</span> such that</p><p class="math-container">\[\left\lbrace
\begin{aligned}
-\nabla \cdot \sigma(u) = f\ &amp;\text{in}\ \Omega,\\
u = -1 \ &amp;\text{on} \ \Gamma_0,\\
u = 1 \ &amp;\text{on} \ \Gamma_1,\\
\sigma(u)\cdot n = 0 \ &amp;\text{elsewhere on} \ \partial\Omega,
\end{aligned}
\right.\]</p><p>with <span>$\sigma(u) = |\nabla u|^{p-2} \ \nabla u$</span> and <span>$p&gt;2$</span>. The vector field <span>$n$</span> is the outwards unit normal vector to <span>$\partial\Omega$</span>. The computational domains are defined in the mesh file <code>model.msh</code>. The domain <span>$\Omega$</span> is represented by the 3D faces in this mesh. The domain <span>$\Gamma_0$</span> is represented by the physical group named <code>&quot;sides&quot;</code> and <span>$\Gamma_1$</span> is the union of the physical groups named <code>&quot;circle&quot;</code>, <code>&quot;triangle&quot;</code>, and <code>&quot;square&quot;</code>.</p><h2 id="Numerical-scheme"><a class="docs-heading-anchor" href="#Numerical-scheme">Numerical scheme</a><a id="Numerical-scheme-1"></a><a class="docs-heading-anchor-permalink" href="#Numerical-scheme" title="Permalink"></a></h2><p>We discretize the problem with a space <span>$V$</span> with piece-wise continuous Lagrangian basis functions. For this formulation, the nonlinear weak form reads: find <span>$u\in V_g$</span> such that <span>$[r(u)](v) = 0$</span> for all <span>$v\in V_0$</span>. The auxiliary spaces <span>$V_g$</span> and <span>$V_0$</span> are the subsets of <span>$V$</span> that fulfill the Dirichlet boundary condition <span>$g$</span> and <span>$0$</span> on <span>$\partial\Omega$</span> respectively.</p><p>The weak residual <span>$r(u)$</span> evaluated at a function  <span>$u\in V_g$</span> is the linear form defined as</p><p class="math-container">\[[r(u)](v) \doteq \int_\Omega \nabla v \cdot \left( |\nabla u|^{p-2}\ \nabla u \right) \ {\rm d}\Omega - \int_\Omega v\ f \ {\rm d}\Omega.\]</p><p>In order to solve this nonlinear weak equation, we consider a Newton-Raphson method, which is associated with a linearization of the problem in an arbitrary direction <span>$\delta u\in V_0$</span>, namely <span>$[r(u+\delta u)](v)\approx [r(u)](v) + [j(u)](\delta u,v)$</span>. In previous formula,  <span>$j(u)$</span> is the Jacobian evaluated at <span>$u\in V_g$</span>, which is the bilinear form</p><p class="math-container">\[[j(u)](\delta u,v) = \int_\Omega \nabla v \cdot \left( |\nabla u|^{p-2}\ \nabla \delta u \right) \ {\rm d}\Omega + (p-2) \int_\Omega \nabla v \cdot \left(  |\nabla u|^{p-4} (\nabla u \cdot \nabla \delta u) \nabla u  \right) \ {\rm d}\Omega.\]</p><h2 id="Implementation"><a class="docs-heading-anchor" href="#Implementation">Implementation</a><a id="Implementation-1"></a><a class="docs-heading-anchor-permalink" href="#Implementation" title="Permalink"></a></h2><pre><code class="language-julia hljs">using LinearAlgebra
import GalerkinToolkit as GT
import PartitionedSolvers as PS
import NonlinearSolve
import ForwardDiff
import GLMakie as Makie

#Read and visualize the mesh
assets_dir = normpath(joinpath(@__DIR__,&quot;..&quot;,&quot;..&quot;,&quot;..&quot;,&quot;assets&quot;))
msh_file = joinpath(assets_dir,&quot;model.msh&quot;)
mesh = GT.mesh_from_msh(msh_file)

#Define domains
dirichlet_0_names = [&quot;sides&quot;]
dirichlet_1_names = [&quot;circle&quot;, &quot;triangle&quot;, &quot;square&quot;]
Ω = GT.interior(mesh)
Γ0 = GT.boundary(mesh;group_names=dirichlet_0_names)
Γ1 = GT.boundary(mesh;group_names=dirichlet_1_names)
Γd = GT.piecewise_domain(Γ0,Γ1)

#Define forcing data
g0 = GT.analytical_field(x-&gt;-1.0,Ω)
g1 = GT.analytical_field(x-&gt;1.0,Ω)
g = GT.piecewise_field(g0,g1)

#Define the interpolation space
k = 1
V = GT.lagrange_space(Ω,k;dirichlet_boundary=Γd)

#Interpolate Dirichlet values
T = Float64
uh = GT.rand_field(T,V)
GT.interpolate_dirichlet!(g,uh)

#Define numerical integration
degree = 2*k
dΩ = GT.measure(Ω,degree)

#Define weak form.
∇ = ForwardDiff.gradient
q = 3
flux(∇u) = norm(∇u)^(q-2) * ∇u
dflux(∇du,∇u) = (q-2)*norm(∇u)^(q-4)*(∇u⋅∇du)*∇u+norm(∇u)^(q-2)*∇du
r = u -&gt; v -&gt; GT.∫( x-&gt; ∇(v,x)⋅GT.call(flux,∇(u,x)), dΩ)
j = u -&gt; (du,v) -&gt; GT.∫( x-&gt; ∇(v,x)⋅GT.call(dflux,∇(du,x),∇(u,x)) , dΩ)

#Define non-linear problem
p = GT.SciMLBase_NonlinearProblem(uh,r,j)

#Solve it
sol = NonlinearSolve.solve(p;show_trace=Val(true))
@assert sol.retcode == NonlinearSolve.ReturnCode.Success

#Get the FE solution object
uh = GT.solution_field(uh,sol)

#Visualize the solution
fig = Makie.Figure()
elevation = 0.24π
azimuth = -0.55π
aspect = :data
ax = Makie.Axis3(fig[1,1];aspect,elevation,azimuth)
Makie.hidespines!(ax)
Makie.hidedecorations!(ax)
GT.makie_surfaces!(Ω;color=uh)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Precompiling NonlinearSolve...
   1686.8 ms  ? DiffEqBase
   1966.4 ms  ? SimpleNonlinearSolve → SimpleNonlinearSolveDiffEqBaseExt
   3667.8 ms  ? NonlinearSolveBase → NonlinearSolveBaseDiffEqBaseExt
   5334.5 ms  ? DiffEqBase → DiffEqBaseSparseArraysExt
   7104.5 ms  ? DiffEqBase → DiffEqBaseChainRulesCoreExt
   8679.2 ms  ? DiffEqBase → DiffEqBaseForwardDiffExt
   6676.1 ms  ? NonlinearSolveSpectralMethods
   5060.0 ms  ? NonlinearSolveQuasiNewton
   5106.9 ms  ? NonlinearSolveFirstOrder
   5137.1 ms  ? NonlinearSolveSpectralMethods → NonlinearSolveSpectralMethodsForwardDiffExt
   5106.0 ms  ? NonlinearSolveQuasiNewton → NonlinearSolveQuasiNewtonForwardDiffExt
Info Given NonlinearSolve was explicitly requested, output will be shown live 
WARNING: Method definition solve(SciMLBase.EnsembleProblem{T, T2, T3, T4, T5} where T5 where T4 where T3 where T2 where T, Any...) in module SciMLBase at /home/runner/.julia/packages/SciMLBase/wQHrI/src/ensemble/basic_ensemble_solve.jl:356 overwritten in module DiffEqBase at /home/runner/.julia/packages/DiffEqBase/AfBQT/src/solve.jl:1224.
ERROR: Method overwriting is not permitted during Module precompilation. Use `__precompile__(false)` to opt-out of precompilation.
   1877.4 ms  ? NonlinearSolve
WARNING: Method definition solve(SciMLBase.EnsembleProblem{T, T2, T3, T4, T5} where T5 where T4 where T3 where T2 where T, Any...) in module SciMLBase at /home/runner/.julia/packages/SciMLBase/wQHrI/src/ensemble/basic_ensemble_solve.jl:356 overwritten in module DiffEqBase at /home/runner/.julia/packages/DiffEqBase/AfBQT/src/solve.jl:1224.
ERROR: Method overwriting is not permitted during Module precompilation. Use `__precompile__(false)` to opt-out of precompilation.
Precompiling DiffEqBase...
Info Given DiffEqBase was explicitly requested, output will be shown live 
WARNING: Method definition solve(SciMLBase.EnsembleProblem{T, T2, T3, T4, T5} where T5 where T4 where T3 where T2 where T, Any...) in module SciMLBase at /home/runner/.julia/packages/SciMLBase/wQHrI/src/ensemble/basic_ensemble_solve.jl:356 overwritten in module DiffEqBase at /home/runner/.julia/packages/DiffEqBase/AfBQT/src/solve.jl:1224.
ERROR: Method overwriting is not permitted during Module precompilation. Use `__precompile__(false)` to opt-out of precompilation.
   1639.8 ms  ? DiffEqBase
WARNING: Method definition solve(SciMLBase.EnsembleProblem{T, T2, T3, T4, T5} where T5 where T4 where T3 where T2 where T, Any...) in module SciMLBase at /home/runner/.julia/packages/SciMLBase/wQHrI/src/ensemble/basic_ensemble_solve.jl:356 overwritten in module DiffEqBase at /home/runner/.julia/packages/DiffEqBase/AfBQT/src/solve.jl:1224.
ERROR: Method overwriting is not permitted during Module precompilation. Use `__precompile__(false)` to opt-out of precompilation.
Precompiling DiffEqBaseUnitfulExt...
   1642.6 ms  ? DiffEqBase
Info Given DiffEqBaseUnitfulExt was explicitly requested, output will be shown live 
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-c56e-b69818e1983e is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
    609.6 ms  ? DiffEqBase → DiffEqBaseUnitfulExt
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-c56e-b69818e1983e is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
Precompiling DiffEqBaseDistributionsExt...
   1629.9 ms  ? DiffEqBase
    769.6 ms  ? DiffEqBase → DiffEqBaseSparseArraysExt
Info Given DiffEqBaseDistributionsExt was explicitly requested, output will be shown live 
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-c56e-b69818e1983e is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
    993.0 ms  ? DiffEqBase → DiffEqBaseDistributionsExt
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-c56e-b69818e1983e is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
Precompiling DiffEqBaseForwardDiffExt...
   1624.1 ms  ? DiffEqBase
Info Given DiffEqBaseForwardDiffExt was explicitly requested, output will be shown live 
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-c56e-b69818e1983e is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
    613.1 ms  ? DiffEqBase → DiffEqBaseForwardDiffExt
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-c56e-b69818e1983e is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
Precompiling DiffEqBaseMPIExt...
   1626.2 ms  ? DiffEqBase
Info Given DiffEqBaseMPIExt was explicitly requested, output will be shown live 
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-c56e-b69818e1983e is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
    625.8 ms  ? DiffEqBase → DiffEqBaseMPIExt
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-c56e-b69818e1983e is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
Precompiling DiffEqBaseChainRulesCoreExt...
   1654.1 ms  ? DiffEqBase
Info Given DiffEqBaseChainRulesCoreExt was explicitly requested, output will be shown live 
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-c56e-b69818e1983e is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
    623.0 ms  ? DiffEqBase → DiffEqBaseChainRulesCoreExt
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-c56e-b69818e1983e is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
Precompiling DiffEqBaseSparseArraysExt...
   1633.0 ms  ? DiffEqBase
Info Given DiffEqBaseSparseArraysExt was explicitly requested, output will be shown live 
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-c56e-b69818e1983e is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
    757.9 ms  ? DiffEqBase → DiffEqBaseSparseArraysExt
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-c56e-b69818e1983e is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
Precompiling NonlinearSolveBaseDiffEqBaseExt...
   1618.4 ms  ? DiffEqBase
Info Given NonlinearSolveBaseDiffEqBaseExt was explicitly requested, output will be shown live 
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-c56e-b69818e1983e is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
    624.8 ms  ? NonlinearSolveBase → NonlinearSolveBaseDiffEqBaseExt
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-c56e-b69818e1983e is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
Precompiling NonlinearSolveFirstOrder...
   1629.7 ms  ? DiffEqBase
    963.8 ms  ? DiffEqBase → DiffEqBaseChainRulesCoreExt
    966.2 ms  ? NonlinearSolveBase → NonlinearSolveBaseDiffEqBaseExt
    971.6 ms  ? DiffEqBase → DiffEqBaseForwardDiffExt
   1147.9 ms  ? DiffEqBase → DiffEqBaseSparseArraysExt
Info Given NonlinearSolveFirstOrder was explicitly requested, output will be shown live 
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-c56e-b69818e1983e is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
    907.8 ms  ? NonlinearSolveFirstOrder
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-c56e-b69818e1983e is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
Precompiling NonlinearSolveQuasiNewton...
   1662.0 ms  ? DiffEqBase
    649.0 ms  ? NonlinearSolveBase → NonlinearSolveBaseDiffEqBaseExt
    858.6 ms  ? DiffEqBase → DiffEqBaseChainRulesCoreExt
   1026.0 ms  ? DiffEqBase → DiffEqBaseSparseArraysExt
Info Given NonlinearSolveQuasiNewton was explicitly requested, output will be shown live 
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-c56e-b69818e1983e is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
    681.6 ms  ? NonlinearSolveQuasiNewton
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-c56e-b69818e1983e is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
Precompiling NonlinearSolveQuasiNewtonForwardDiffExt...
   1631.7 ms  ? DiffEqBase
    980.8 ms  ? NonlinearSolveBase → NonlinearSolveBaseDiffEqBaseExt
    991.4 ms  ? DiffEqBase → DiffEqBaseForwardDiffExt
    993.4 ms  ? DiffEqBase → DiffEqBaseChainRulesCoreExt
   1140.3 ms  ? DiffEqBase → DiffEqBaseSparseArraysExt
    663.9 ms  ? NonlinearSolveQuasiNewton
Info Given NonlinearSolveQuasiNewtonForwardDiffExt was explicitly requested, output will be shown live 
┌ Warning: Module NonlinearSolveQuasiNewton with build ID ffffffff-ffff-ffff-6238-71229182ac19 is missing from the cache.
│ This may mean NonlinearSolveQuasiNewton [9a2c21bd-3a47-402d-9113-8faf9a0ee114] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
   1079.1 ms  ? NonlinearSolveQuasiNewton → NonlinearSolveQuasiNewtonForwardDiffExt
┌ Warning: Module NonlinearSolveQuasiNewton with build ID ffffffff-ffff-ffff-6238-71229182ac19 is missing from the cache.
│ This may mean NonlinearSolveQuasiNewton [9a2c21bd-3a47-402d-9113-8faf9a0ee114] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
Precompiling SimpleNonlinearSolveDiffEqBaseExt...
   1637.3 ms  ? DiffEqBase
Info Given SimpleNonlinearSolveDiffEqBaseExt was explicitly requested, output will be shown live 
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-c56e-b69818e1983e is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
    635.1 ms  ? SimpleNonlinearSolve → SimpleNonlinearSolveDiffEqBaseExt
    862.3 ms  ? DiffEqBase → DiffEqBaseForwardDiffExt
    865.4 ms  ? NonlinearSolveBase → NonlinearSolveBaseDiffEqBaseExt
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-c56e-b69818e1983e is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
Precompiling NonlinearSolveSpectralMethods...
   1649.1 ms  ? DiffEqBase
    627.2 ms  ? NonlinearSolveBase → NonlinearSolveBaseDiffEqBaseExt
Info Given NonlinearSolveSpectralMethods was explicitly requested, output will be shown live 
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-c56e-b69818e1983e is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
    665.1 ms  ? NonlinearSolveSpectralMethods
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-c56e-b69818e1983e is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
Precompiling NonlinearSolveSpectralMethodsForwardDiffExt...
   1632.3 ms  ? DiffEqBase
    645.7 ms  ? DiffEqBase → DiffEqBaseForwardDiffExt
    646.7 ms  ? NonlinearSolveBase → NonlinearSolveBaseDiffEqBaseExt
    642.0 ms  ? NonlinearSolveSpectralMethods
Info Given NonlinearSolveSpectralMethodsForwardDiffExt was explicitly requested, output will be shown live 
┌ Warning: Module NonlinearSolveSpectralMethods with build ID ffffffff-ffff-ffff-326d-b17d2d6d72c6 is missing from the cache.
│ This may mean NonlinearSolveSpectralMethods [26075421-4e9a-44e1-8bd1-420ed7ad02b2] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
   1048.6 ms  ? NonlinearSolveSpectralMethods → NonlinearSolveSpectralMethodsForwardDiffExt
┌ Warning: Module NonlinearSolveSpectralMethods with build ID ffffffff-ffff-ffff-326d-b17d2d6d72c6 is missing from the cache.
│ This may mean NonlinearSolveSpectralMethods [26075421-4e9a-44e1-8bd1-420ed7ad02b2] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
Precompiling NonlinearSolveNLsolveExt...
   1695.1 ms  ? DiffEqBase
   1145.1 ms  ? SimpleNonlinearSolve → SimpleNonlinearSolveDiffEqBaseExt
   1163.8 ms  ? DiffEqBase → DiffEqBaseForwardDiffExt
   1222.3 ms  ? NonlinearSolveBase → NonlinearSolveBaseDiffEqBaseExt
   1266.9 ms  ? DiffEqBase → DiffEqBaseChainRulesCoreExt
   1337.3 ms  ? DiffEqBase → DiffEqBaseSparseArraysExt
    965.9 ms  ? NonlinearSolveSpectralMethods
    976.6 ms  ? NonlinearSolveQuasiNewton
   1000.2 ms  ? NonlinearSolveFirstOrder
   1120.4 ms  ? NonlinearSolveSpectralMethods → NonlinearSolveSpectralMethodsForwardDiffExt
   1062.3 ms  ? NonlinearSolveQuasiNewton → NonlinearSolveQuasiNewtonForwardDiffExt
    662.4 ms  ? NonlinearSolve
Info Given NonlinearSolveNLsolveExt was explicitly requested, output will be shown live 
┌ Warning: Module NonlinearSolve with build ID ffffffff-ffff-ffff-6a7e-a1b1735588d9 is missing from the cache.
│ This may mean NonlinearSolve [8913a72c-1f9b-4ce2-8d82-65094dcecaec] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
   1070.4 ms  ? NonlinearSolve → NonlinearSolveNLsolveExt
┌ Warning: Module NonlinearSolve with build ID ffffffff-ffff-ffff-6a7e-a1b1735588d9 is missing from the cache.
│ This may mean NonlinearSolve [8913a72c-1f9b-4ce2-8d82-65094dcecaec] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541

Algorithm: NewtonRaphson(
    descent = NewtonDescent(),
    autodiff = AutoForwardDiff(),
    vjp_autodiff = AutoFiniteDiff(
        fdtype = Val{:forward}(),
        fdjtype = Val{:forward}(),
        fdhtype = Val{:hcentral}(),
        dir = true
    ),
    jvp_autodiff = AutoForwardDiff(),
    concrete_jac = Val{false}()
)

----    	-------------       	-----------
Iter    	f(u) inf-norm       	Step 2-norm
----    	-------------       	-----------
0       	1.25651522e+01      	NaN
1       	3.15973837e+00      	1.71507363e+01
2       	7.97191980e-01      	8.17262208e+00
3       	1.97733888e-01      	3.17854817e+00
4       	4.51538033e-02      	1.00377178e+00
5       	7.73345246e-03      	2.44750185e-01
6       	1.98360576e-03      	5.23804767e-02
7       	3.99021744e-04      	1.11931903e-02
8       	1.72958685e-05      	3.10227684e-03
9       	2.28919248e-08      	1.63828792e-04
10      	9.06037330e-14      	3.14956217e-07
Final   	9.06037330e-14
----------------------</code></pre><h2 id="Building-the-algebraic-non-linear-problem-explicitly"><a class="docs-heading-anchor" href="#Building-the-algebraic-non-linear-problem-explicitly">Building the algebraic non-linear problem explicitly</a><a id="Building-the-algebraic-non-linear-problem-explicitly-1"></a><a class="docs-heading-anchor-permalink" href="#Building-the-algebraic-non-linear-problem-explicitly" title="Permalink"></a></h2><p>In this other version, we explicitly build the algebraic residual and Jacobian (functions that take plain Julia vectors) and build a algebraic non-linear problem from them.</p><pre><code class="language-julia hljs">import SciMLBase

#Initial guess
x = rand(T,GT.num_free_dofs(V))
GT.solution_field!(uh,x)

#Initial residual and Jacobian
reuse = Val(true)
parameters = (uh,)
b,residual_cache = GT.assemble_vector(r(uh),T,V;parameters,reuse)
A,jacobian_cache = GT.assemble_matrix(j(uh),T,V,V;parameters,reuse)

#Algebraic residual and Jacobian functions
function f(dx,x,p)
    GT.solution_field!(uh,x)
    GT.update_vector!(dx,residual_cache;parameters)
    dx
end

function jac(J,x,p)
    GT.solution_field!(uh,x)
    GT.update_matrix!(J,jacobian_cache;parameters)
    J
end

#Build the nonlinear problem
jac_prototype = A
nlfun = SciMLBase.NonlinearFunction(f;jac,jac_prototype)
p = SciMLBase.NonlinearProblem(nlfun,x)

#Solve it
sol = NonlinearSolve.solve(p;show_trace=Val(true))
@assert sol.retcode == NonlinearSolve.ReturnCode.Success

#Get the FE solution object
x = sol.u
GT.solution_field!(uh,x)

#Visualize the solution
fig = Makie.Figure()
elevation = 0.24π
azimuth = -0.55π
aspect = :data
ax = Makie.Axis3(fig[1,1];aspect,elevation,azimuth)
Makie.hidespines!(ax)
Makie.hidedecorations!(ax)
GT.makie_surfaces!(Ω;color=uh)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">
Algorithm: NewtonRaphson(
    descent = NewtonDescent(),
    autodiff = AutoForwardDiff(),
    vjp_autodiff = AutoFiniteDiff(
        fdtype = Val{:forward}(),
        fdjtype = Val{:forward}(),
        fdhtype = Val{:hcentral}(),
        dir = true
    ),
    jvp_autodiff = AutoForwardDiff(),
    concrete_jac = Val{false}()
)

----    	-------------       	-----------
Iter    	f(u) inf-norm       	Step 2-norm
----    	-------------       	-----------
0       	1.92988994e+01      	NaN
1       	4.92329098e+00      	1.71206371e+01
2       	1.23359682e+00      	7.87764190e+00
3       	2.02167120e-01      	3.11998184e+00
4       	4.68426697e-02      	1.06478092e+00
5       	1.12100689e-02      	2.52190076e-01
6       	1.02060797e-03      	5.62808562e-02
7       	2.15213674e-04      	9.90266004e-03
8       	3.81829141e-06      	2.00222291e-03
9       	6.02503637e-09      	6.64511725e-05
10      	1.58971008e-14      	1.03277919e-07
Final   	1.58971008e-14
----------------------</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../example_poisson_equation/">« Poisson equation</a><a class="docs-footer-nextpage" href="../example_stokes/">Stokes lid-driven cavity »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Thursday 28 August 2025 17:39">Thursday 28 August 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
