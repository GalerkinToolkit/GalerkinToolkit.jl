<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>p-Laplacian · GalerkinToolkit.jl</title><meta name="title" content="p-Laplacian · GalerkinToolkit.jl"/><meta property="og:title" content="p-Laplacian · GalerkinToolkit.jl"/><meta property="twitter:title" content="p-Laplacian · GalerkinToolkit.jl"/><meta name="description" content="Documentation for GalerkinToolkit.jl."/><meta property="og:description" content="Documentation for GalerkinToolkit.jl."/><meta property="twitter:description" content="Documentation for GalerkinToolkit.jl."/><meta property="og:url" content="https://GalerkinToolkit.github.io/GalerkinToolkit.jl/src_md/example_p_laplacian/"/><meta property="twitter:url" content="https://GalerkinToolkit.github.io/GalerkinToolkit.jl/src_md/example_p_laplacian/"/><link rel="canonical" href="https://GalerkinToolkit.github.io/GalerkinToolkit.jl/src_md/example_p_laplacian/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/citations.css" rel="stylesheet" type="text/css"/><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="GalerkinToolkit.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">GalerkinToolkit.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../manual/">Manual</a></li><li><a class="tocitem" href="../../manual/introduction/">Introduction</a></li><li><a class="tocitem" href="../manual_meshes/">Meshes</a></li><li><a class="tocitem" href="../manual_domains/">Domains</a></li><li><a class="tocitem" href="../manual_interpolation/">Interpolation</a></li><li><a class="tocitem" href="../manual_visualization/">Visualization</a></li><li><a class="tocitem" href="../../manual/for_developers/">For developers</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/">Examples</a></li><li><a class="tocitem" href="../example_hello_world/">Hello, World!</a></li><li><a class="tocitem" href="../example_poisson_equation/">Poisson equation</a></li><li class="is-active"><a class="tocitem" href>p-Laplacian</a><ul class="internal"><li><a class="tocitem" href="#Problem-statement"><span>Problem statement</span></a></li><li><a class="tocitem" href="#Numerical-scheme"><span>Numerical scheme</span></a></li><li><a class="tocitem" href="#Implementation"><span>Implementation</span></a></li><li><a class="tocitem" href="#Building-the-algebraic-non-linear-problem-explicitly"><span>Building the algebraic non-linear problem explicitly</span></a></li></ul></li><li><a class="tocitem" href="../example_stokes/">Stokes lid-driven cavity</a></li><li><a class="tocitem" href="../example_transient_heat_eq/">Transient heat equation</a></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/">Tutorials</a></li><li><a class="tocitem" href="../tutorial_intro_to_fem/">Introduction to the FEM</a></li></ul></li><li><a class="tocitem" href="../../reference/">API</a></li><li><a class="tocitem" href="../../refindex/">Index</a></li><li><a class="tocitem" href="../../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>p-Laplacian</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>p-Laplacian</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/GalerkinToolkit/GalerkinToolkit.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/GalerkinToolkit/GalerkinToolkit.jl/blob/main/docs/src/src_jl/example_p_laplacian.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="p-Laplacian"><a class="docs-heading-anchor" href="#p-Laplacian">p-Laplacian</a><a id="p-Laplacian-1"></a><a class="docs-heading-anchor-permalink" href="#p-Laplacian" title="Permalink"></a></h1><p><img src="../fig_p_laplacian_1.png" alt/></p><h2 id="Problem-statement"><a class="docs-heading-anchor" href="#Problem-statement">Problem statement</a><a id="Problem-statement-1"></a><a class="docs-heading-anchor-permalink" href="#Problem-statement" title="Permalink"></a></h2><p>Find the scalar-field <span>$u$</span> such that</p><p class="math-container">\[\left\lbrace
\begin{aligned}
-\nabla \cdot \sigma(u) = f\ &amp;\text{in}\ \Omega,\\
u = -1 \ &amp;\text{on} \ \Gamma_0,\\
u = 1 \ &amp;\text{on} \ \Gamma_1,\\
\sigma(u)\cdot n = 0 \ &amp;\text{elsewhere on} \ \partial\Omega,
\end{aligned}
\right.\]</p><p>with <span>$\sigma(u) = |\nabla u|^{p-2} \ \nabla u$</span> and <span>$p&gt;2$</span>. The vector field <span>$n$</span> is the outwards unit normal vector to <span>$\partial\Omega$</span>. The computational domains are defined in the mesh file <code>model.msh</code>. The domain <span>$\Omega$</span> is represented by the 3D faces in this mesh. The domain <span>$\Gamma_0$</span> is represented by the physical group named <code>&quot;sides&quot;</code> and <span>$\Gamma_1$</span> is the union of the physical groups named <code>&quot;circle&quot;</code>, <code>&quot;triangle&quot;</code>, and <code>&quot;square&quot;</code>.</p><h2 id="Numerical-scheme"><a class="docs-heading-anchor" href="#Numerical-scheme">Numerical scheme</a><a id="Numerical-scheme-1"></a><a class="docs-heading-anchor-permalink" href="#Numerical-scheme" title="Permalink"></a></h2><p>We discretize the problem with a space <span>$V$</span> with piece-wise continuous Lagrangian basis functions. For this formulation, the nonlinear weak form reads: find <span>$u\in V_g$</span> such that <span>$[r(u)](v) = 0$</span> for all <span>$v\in V_0$</span>. The auxiliary spaces <span>$V_g$</span> and <span>$V_0$</span> are the subsets of <span>$V$</span> that fulfill the Dirichlet boundary condition <span>$g$</span> and <span>$0$</span> on <span>$\partial\Omega$</span> respectively.</p><p>The weak residual <span>$r(u)$</span> evaluated at a function  <span>$u\in V_g$</span> is the linear form defined as</p><p class="math-container">\[[r(u)](v) \doteq \int_\Omega \nabla v \cdot \left( |\nabla u|^{p-2}\ \nabla u \right) \ {\rm d}\Omega - \int_\Omega v\ f \ {\rm d}\Omega.\]</p><p>In order to solve this nonlinear weak equation, we consider a Newton-Raphson method, which is associated with a linearization of the problem in an arbitrary direction <span>$\delta u\in V_0$</span>, namely <span>$[r(u+\delta u)](v)\approx [r(u)](v) + [j(u)](\delta u,v)$</span>. In previous formula,  <span>$j(u)$</span> is the Jacobian evaluated at <span>$u\in V_g$</span>, which is the bilinear form</p><p class="math-container">\[[j(u)](\delta u,v) = \int_\Omega \nabla v \cdot \left( |\nabla u|^{p-2}\ \nabla \delta u \right) \ {\rm d}\Omega + (p-2) \int_\Omega \nabla v \cdot \left(  |\nabla u|^{p-4} (\nabla u \cdot \nabla \delta u) \nabla u  \right) \ {\rm d}\Omega.\]</p><h2 id="Implementation"><a class="docs-heading-anchor" href="#Implementation">Implementation</a><a id="Implementation-1"></a><a class="docs-heading-anchor-permalink" href="#Implementation" title="Permalink"></a></h2><pre><code class="language-julia hljs">using LinearAlgebra
import GalerkinToolkit as GT
import PartitionedSolvers as PS
import NonlinearSolve
import ForwardDiff
import GLMakie as Makie

#Read and visualize the mesh
assets_dir = normpath(joinpath(@__DIR__,&quot;..&quot;,&quot;..&quot;,&quot;..&quot;,&quot;assets&quot;))
msh_file = joinpath(assets_dir,&quot;model.msh&quot;)
mesh = GT.mesh_from_msh(msh_file)

#Define domains
dirichlet_0_names = [&quot;sides&quot;]
dirichlet_1_names = [&quot;circle&quot;, &quot;triangle&quot;, &quot;square&quot;]
Ω = GT.interior(mesh)
Γ0 = GT.boundary(mesh;group_names=dirichlet_0_names)
Γ1 = GT.boundary(mesh;group_names=dirichlet_1_names)
Γd = GT.piecewise_domain(Γ0,Γ1)

#Define forcing data
g0 = GT.analytical_field(x-&gt;-1.0,Ω)
g1 = GT.analytical_field(x-&gt;1.0,Ω)
g = GT.piecewise_field(g0,g1)

#Define the interpolation space
k = 1
V = GT.lagrange_space(Ω,k;dirichlet_boundary=Γd)

#Interpolate Dirichlet values
T = Float64
uh = GT.rand_field(T,V)
GT.interpolate_dirichlet!(g,uh)

#Define numerical integration
degree = 2*k
dΩ = GT.measure(Ω,degree)

#Define weak form.
∇ = ForwardDiff.gradient
q = 3
flux(∇u) = norm(∇u)^(q-2) * ∇u
dflux(∇du,∇u) = (q-2)*norm(∇u)^(q-4)*(∇u⋅∇du)*∇u+norm(∇u)^(q-2)*∇du
r = u -&gt; v -&gt; GT.∫( x-&gt; ∇(v,x)⋅GT.call(flux,∇(u,x)), dΩ)
j = u -&gt; (du,v) -&gt; GT.∫( x-&gt; ∇(v,x)⋅GT.call(dflux,∇(du,x),∇(u,x)) , dΩ)

#Define non-linear problem
p = GT.SciMLBase_NonlinearProblem(uh,r,j)

#Solve it
sol = NonlinearSolve.solve(p;show_trace=Val(true))
@assert sol.retcode == NonlinearSolve.ReturnCode.Success

#Get the FE solution object
uh = GT.solution_field(uh,sol)

#Visualize the solution
fig = Makie.Figure()
elevation = 0.24π
azimuth = -0.55π
aspect = :data
ax = Makie.Axis3(fig[1,1];aspect,elevation,azimuth)
Makie.hidespines!(ax)
Makie.hidedecorations!(ax)
GT.makie_surfaces!(Ω;color=uh)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Precompiling NonlinearSolve...
   1686.0 ms  ? DiffEqBase
   2015.7 ms  ? DiffEqBase → DiffEqBaseForwardDiffExt
   3665.5 ms  ? NonlinearSolveBase → NonlinearSolveBaseDiffEqBaseExt
   5454.1 ms  ? DiffEqBase → DiffEqBaseChainRulesCoreExt
   7032.3 ms  ? DiffEqBase → DiffEqBaseSparseArraysExt
   5141.2 ms  ? NonlinearSolveSpectralMethods
   3483.1 ms  ? NonlinearSolveFirstOrder
   5155.2 ms  ? NonlinearSolveQuasiNewton
   5091.7 ms  ? NonlinearSolveSpectralMethods → NonlinearSolveSpectralMethodsForwardDiffExt
   3372.1 ms  ? NonlinearSolveQuasiNewton → NonlinearSolveQuasiNewtonForwardDiffExt
  17199.8 ms  ? SimpleNonlinearSolve → SimpleNonlinearSolveDiffEqBaseExt
Info Given NonlinearSolve was explicitly requested, output will be shown live 
WARNING: Method definition solve(SciMLBase.EnsembleProblem{T, T2, T3, T4, T5} where T5 where T4 where T3 where T2 where T, Any...) in module SciMLBase at /home/runner/.julia/packages/SciMLBase/wQHrI/src/ensemble/basic_ensemble_solve.jl:356 overwritten in module DiffEqBase at /home/runner/.julia/packages/DiffEqBase/AfBQT/src/solve.jl:1224.
ERROR: Method overwriting is not permitted during Module precompilation. Use `__precompile__(false)` to opt-out of precompilation.
   1894.9 ms  ? NonlinearSolve
WARNING: Method definition solve(SciMLBase.EnsembleProblem{T, T2, T3, T4, T5} where T5 where T4 where T3 where T2 where T, Any...) in module SciMLBase at /home/runner/.julia/packages/SciMLBase/wQHrI/src/ensemble/basic_ensemble_solve.jl:356 overwritten in module DiffEqBase at /home/runner/.julia/packages/DiffEqBase/AfBQT/src/solve.jl:1224.
ERROR: Method overwriting is not permitted during Module precompilation. Use `__precompile__(false)` to opt-out of precompilation.
Precompiling DiffEqBase...
Info Given DiffEqBase was explicitly requested, output will be shown live 
WARNING: Method definition solve(SciMLBase.EnsembleProblem{T, T2, T3, T4, T5} where T5 where T4 where T3 where T2 where T, Any...) in module SciMLBase at /home/runner/.julia/packages/SciMLBase/wQHrI/src/ensemble/basic_ensemble_solve.jl:356 overwritten in module DiffEqBase at /home/runner/.julia/packages/DiffEqBase/AfBQT/src/solve.jl:1224.
ERROR: Method overwriting is not permitted during Module precompilation. Use `__precompile__(false)` to opt-out of precompilation.
   1632.7 ms  ? DiffEqBase
WARNING: Method definition solve(SciMLBase.EnsembleProblem{T, T2, T3, T4, T5} where T5 where T4 where T3 where T2 where T, Any...) in module SciMLBase at /home/runner/.julia/packages/SciMLBase/wQHrI/src/ensemble/basic_ensemble_solve.jl:356 overwritten in module DiffEqBase at /home/runner/.julia/packages/DiffEqBase/AfBQT/src/solve.jl:1224.
ERROR: Method overwriting is not permitted during Module precompilation. Use `__precompile__(false)` to opt-out of precompilation.
Precompiling DiffEqBaseUnitfulExt...
   1627.9 ms  ? DiffEqBase
Info Given DiffEqBaseUnitfulExt was explicitly requested, output will be shown live 
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-d13e-a1878c5fbd8b is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
    611.0 ms  ? DiffEqBase → DiffEqBaseUnitfulExt
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-d13e-a1878c5fbd8b is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
Precompiling DiffEqBaseDistributionsExt...
   1607.2 ms  ? DiffEqBase
    780.7 ms  ? DiffEqBase → DiffEqBaseSparseArraysExt
Info Given DiffEqBaseDistributionsExt was explicitly requested, output will be shown live 
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-d13e-a1878c5fbd8b is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
   1001.0 ms  ? DiffEqBase → DiffEqBaseDistributionsExt
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-d13e-a1878c5fbd8b is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
Precompiling DiffEqBaseForwardDiffExt...
   1609.4 ms  ? DiffEqBase
Info Given DiffEqBaseForwardDiffExt was explicitly requested, output will be shown live 
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-d13e-a1878c5fbd8b is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
    621.6 ms  ? DiffEqBase → DiffEqBaseForwardDiffExt
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-d13e-a1878c5fbd8b is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
Precompiling DiffEqBaseMPIExt...
   1614.0 ms  ? DiffEqBase
Info Given DiffEqBaseMPIExt was explicitly requested, output will be shown live 
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-d13e-a1878c5fbd8b is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
    605.6 ms  ? DiffEqBase → DiffEqBaseMPIExt
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-d13e-a1878c5fbd8b is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
Precompiling DiffEqBaseChainRulesCoreExt...
   1605.8 ms  ? DiffEqBase
Info Given DiffEqBaseChainRulesCoreExt was explicitly requested, output will be shown live 
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-d13e-a1878c5fbd8b is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
    610.2 ms  ? DiffEqBase → DiffEqBaseChainRulesCoreExt
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-d13e-a1878c5fbd8b is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
Precompiling DiffEqBaseSparseArraysExt...
   1634.9 ms  ? DiffEqBase
Info Given DiffEqBaseSparseArraysExt was explicitly requested, output will be shown live 
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-d13e-a1878c5fbd8b is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
    749.8 ms  ? DiffEqBase → DiffEqBaseSparseArraysExt
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-d13e-a1878c5fbd8b is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
Precompiling NonlinearSolveBaseDiffEqBaseExt...
   1625.3 ms  ? DiffEqBase
Info Given NonlinearSolveBaseDiffEqBaseExt was explicitly requested, output will be shown live 
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-d13e-a1878c5fbd8b is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
    627.7 ms  ? NonlinearSolveBase → NonlinearSolveBaseDiffEqBaseExt
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-d13e-a1878c5fbd8b is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
Precompiling NonlinearSolveFirstOrder...
   1634.7 ms  ? DiffEqBase
    963.3 ms  ? DiffEqBase → DiffEqBaseForwardDiffExt
    961.7 ms  ? NonlinearSolveBase → NonlinearSolveBaseDiffEqBaseExt
    973.9 ms  ? DiffEqBase → DiffEqBaseChainRulesCoreExt
   1144.9 ms  ? DiffEqBase → DiffEqBaseSparseArraysExt
Info Given NonlinearSolveFirstOrder was explicitly requested, output will be shown live 
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-d13e-a1878c5fbd8b is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
    917.4 ms  ? NonlinearSolveFirstOrder
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-d13e-a1878c5fbd8b is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
Precompiling NonlinearSolveQuasiNewton...
   1627.3 ms  ? DiffEqBase
    634.5 ms  ? NonlinearSolveBase → NonlinearSolveBaseDiffEqBaseExt
    840.0 ms  ? DiffEqBase → DiffEqBaseChainRulesCoreExt
   1016.6 ms  ? DiffEqBase → DiffEqBaseSparseArraysExt
Info Given NonlinearSolveQuasiNewton was explicitly requested, output will be shown live 
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-d13e-a1878c5fbd8b is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
    661.6 ms  ? NonlinearSolveQuasiNewton
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-d13e-a1878c5fbd8b is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
Precompiling NonlinearSolveQuasiNewtonForwardDiffExt...
   1628.6 ms  ? DiffEqBase
    966.9 ms  ? NonlinearSolveBase → NonlinearSolveBaseDiffEqBaseExt
    986.9 ms  ? DiffEqBase → DiffEqBaseChainRulesCoreExt
    985.2 ms  ? DiffEqBase → DiffEqBaseForwardDiffExt
   1133.6 ms  ? DiffEqBase → DiffEqBaseSparseArraysExt
    660.4 ms  ? NonlinearSolveQuasiNewton
Info Given NonlinearSolveQuasiNewtonForwardDiffExt was explicitly requested, output will be shown live 
┌ Warning: Module NonlinearSolveQuasiNewton with build ID ffffffff-ffff-ffff-03e0-13a292f6b6c5 is missing from the cache.
│ This may mean NonlinearSolveQuasiNewton [9a2c21bd-3a47-402d-9113-8faf9a0ee114] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
   1034.7 ms  ? NonlinearSolveQuasiNewton → NonlinearSolveQuasiNewtonForwardDiffExt
┌ Warning: Module NonlinearSolveQuasiNewton with build ID ffffffff-ffff-ffff-03e0-13a292f6b6c5 is missing from the cache.
│ This may mean NonlinearSolveQuasiNewton [9a2c21bd-3a47-402d-9113-8faf9a0ee114] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
Precompiling SimpleNonlinearSolveDiffEqBaseExt...
   1635.9 ms  ? DiffEqBase
    636.8 ms  ? NonlinearSolveBase → NonlinearSolveBaseDiffEqBaseExt
Info Given SimpleNonlinearSolveDiffEqBaseExt was explicitly requested, output will be shown live 
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-d13e-a1878c5fbd8b is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
    854.9 ms  ? DiffEqBase → DiffEqBaseForwardDiffExt
    854.0 ms  ? SimpleNonlinearSolve → SimpleNonlinearSolveDiffEqBaseExt
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-d13e-a1878c5fbd8b is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
Precompiling NonlinearSolveSpectralMethods...
   1619.1 ms  ? DiffEqBase
    627.4 ms  ? NonlinearSolveBase → NonlinearSolveBaseDiffEqBaseExt
Info Given NonlinearSolveSpectralMethods was explicitly requested, output will be shown live 
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-d13e-a1878c5fbd8b is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
    650.8 ms  ? NonlinearSolveSpectralMethods
┌ Warning: Module DiffEqBase with build ID ffffffff-ffff-ffff-d13e-a1878c5fbd8b is missing from the cache.
│ This may mean DiffEqBase [2b5f629d-d688-5b77-993f-72d75c75574e] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
Precompiling NonlinearSolveSpectralMethodsForwardDiffExt...
   1609.1 ms  ? DiffEqBase
    629.4 ms  ? DiffEqBase → DiffEqBaseForwardDiffExt
    647.4 ms  ? NonlinearSolveBase → NonlinearSolveBaseDiffEqBaseExt
    647.7 ms  ? NonlinearSolveSpectralMethods
Info Given NonlinearSolveSpectralMethodsForwardDiffExt was explicitly requested, output will be shown live 
┌ Warning: Module NonlinearSolveSpectralMethods with build ID ffffffff-ffff-ffff-3662-2adb65855073 is missing from the cache.
│ This may mean NonlinearSolveSpectralMethods [26075421-4e9a-44e1-8bd1-420ed7ad02b2] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
   1054.1 ms  ? NonlinearSolveSpectralMethods → NonlinearSolveSpectralMethodsForwardDiffExt
┌ Warning: Module NonlinearSolveSpectralMethods with build ID ffffffff-ffff-ffff-3662-2adb65855073 is missing from the cache.
│ This may mean NonlinearSolveSpectralMethods [26075421-4e9a-44e1-8bd1-420ed7ad02b2] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
Precompiling NonlinearSolveNLsolveExt...
   1632.3 ms  ? DiffEqBase
   1141.2 ms  ? DiffEqBase → DiffEqBaseChainRulesCoreExt
   1192.4 ms  ? NonlinearSolveBase → NonlinearSolveBaseDiffEqBaseExt
   1220.0 ms  ? SimpleNonlinearSolve → SimpleNonlinearSolveDiffEqBaseExt
   1251.6 ms  ? DiffEqBase → DiffEqBaseForwardDiffExt
   1340.7 ms  ? DiffEqBase → DiffEqBaseSparseArraysExt
    692.4 ms  ? NonlinearSolveSpectralMethods
   1011.6 ms  ? NonlinearSolveQuasiNewton
   1309.1 ms  ? NonlinearSolveFirstOrder
   1202.5 ms  ? NonlinearSolveSpectralMethods → NonlinearSolveSpectralMethodsForwardDiffExt
   1141.1 ms  ? NonlinearSolveQuasiNewton → NonlinearSolveQuasiNewtonForwardDiffExt
    662.9 ms  ? NonlinearSolve
Info Given NonlinearSolveNLsolveExt was explicitly requested, output will be shown live 
┌ Warning: Module NonlinearSolve with build ID ffffffff-ffff-ffff-e208-8d1f8ace80a3 is missing from the cache.
│ This may mean NonlinearSolve [8913a72c-1f9b-4ce2-8d82-65094dcecaec] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541
   1043.8 ms  ? NonlinearSolve → NonlinearSolveNLsolveExt
┌ Warning: Module NonlinearSolve with build ID ffffffff-ffff-ffff-e208-8d1f8ace80a3 is missing from the cache.
│ This may mean NonlinearSolve [8913a72c-1f9b-4ce2-8d82-65094dcecaec] does not support precompilation but is imported by a module that does.
└ @ Base loading.jl:2541

Algorithm: NewtonRaphson(
    descent = NewtonDescent(),
    autodiff = AutoForwardDiff(),
    vjp_autodiff = AutoFiniteDiff(
        fdtype = Val{:forward}(),
        fdjtype = Val{:forward}(),
        fdhtype = Val{:hcentral}(),
        dir = true
    ),
    jvp_autodiff = AutoForwardDiff(),
    concrete_jac = Val{false}()
)

----    	-------------       	-----------
Iter    	f(u) inf-norm       	Step 2-norm
----    	-------------       	-----------
0       	1.37169847e+01      	0.00000000e+00
1       	3.44236501e+00      	1.65895054e+01
2       	8.74334474e-01      	7.89290402e+00
3       	2.30591355e-01      	3.16101881e+00
4       	3.13559578e-02      	9.79149738e-01
5       	6.75383603e-03      	2.54921282e-01
6       	1.11402840e-03      	5.85724071e-02
7       	1.13129801e-04      	1.27151308e-02
8       	6.54478853e-06      	2.30450943e-03
9       	1.90984395e-08      	1.34622148e-04
10      	2.87485964e-13      	4.14265762e-07
Final   	2.87485964e-13
----------------------</code></pre><h2 id="Building-the-algebraic-non-linear-problem-explicitly"><a class="docs-heading-anchor" href="#Building-the-algebraic-non-linear-problem-explicitly">Building the algebraic non-linear problem explicitly</a><a id="Building-the-algebraic-non-linear-problem-explicitly-1"></a><a class="docs-heading-anchor-permalink" href="#Building-the-algebraic-non-linear-problem-explicitly" title="Permalink"></a></h2><p>In this other version, we explicitly build the algebraic residual and Jacobian (functions that take plain Julia vectors) and build a algebraic non-linear problem from them.</p><pre><code class="language-julia hljs">import SciMLBase

#Initial guess
x = rand(T,GT.num_free_dofs(V))
GT.solution_field!(uh,x)

#Initial residual and Jacobian
reuse = Val(true)
parameters = (uh,)
b,residual_cache = GT.assemble_vector(r(uh),T,V;parameters,reuse)
A,jacobian_cache = GT.assemble_matrix(j(uh),T,V,V;parameters,reuse)

#Algebraic residual and Jacobian functions
function f(dx,x,p)
    GT.solution_field!(uh,x)
    GT.update_vector!(dx,residual_cache;parameters)
    dx
end

function jac(J,x,p)
    GT.solution_field!(uh,x)
    GT.update_matrix!(J,jacobian_cache;parameters)
    J
end

#Build the nonlinear problem
jac_prototype = A
nlfun = SciMLBase.NonlinearFunction(f;jac,jac_prototype)
p = SciMLBase.NonlinearProblem(nlfun,x)

#Solve it
sol = NonlinearSolve.solve(p;show_trace=Val(true))
@assert sol.retcode == NonlinearSolve.ReturnCode.Success

#Get the FE solution object
x = sol.u
GT.solution_field!(uh,x)

#Visualize the solution
fig = Makie.Figure()
elevation = 0.24π
azimuth = -0.55π
aspect = :data
ax = Makie.Axis3(fig[1,1];aspect,elevation,azimuth)
Makie.hidespines!(ax)
Makie.hidedecorations!(ax)
GT.makie_surfaces!(Ω;color=uh)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">
Algorithm: NewtonRaphson(
    descent = NewtonDescent(),
    autodiff = AutoForwardDiff(),
    vjp_autodiff = AutoFiniteDiff(
        fdtype = Val{:forward}(),
        fdjtype = Val{:forward}(),
        fdhtype = Val{:hcentral}(),
        dir = true
    ),
    jvp_autodiff = AutoForwardDiff(),
    concrete_jac = Val{false}()
)

----    	-------------       	-----------
Iter    	f(u) inf-norm       	Step 2-norm
----    	-------------       	-----------
0       	2.12107678e+01      	NaN
1       	5.35297661e+00      	1.69623576e+01
2       	1.46448445e+00      	7.85256522e+00
3       	2.33772711e-01      	3.12742743e+00
4       	3.93671905e-02      	9.94761741e-01
5       	7.33660800e-03      	2.61044589e-01
6       	1.81616801e-03      	5.91519382e-02
7       	4.26487612e-04      	1.59251807e-02
8       	4.56219193e-05      	4.09259821e-03
9       	5.43817795e-07      	4.97626803e-04
10      	8.71713637e-11      	6.73783321e-06
11      	3.74700271e-16      	1.23559082e-09
Final   	3.74700271e-16
----------------------</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../example_poisson_equation/">« Poisson equation</a><a class="docs-footer-nextpage" href="../example_stokes/">Stokes lid-driven cavity »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Friday 29 August 2025 11:14">Friday 29 August 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
